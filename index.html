<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Children‚Äôs Heart Allograft Risk and Transplantation Index (C-HART): 1-year mortality</title>
  <style>
    :root {
  --bg:#0b1020;
  --card:#121a33;
  --text:#e9ecf5;
  --muted:#aab3d1;
  --accent:#7aa2ff;
  --border:#22305f;
  --pink:#f3b6c8; /* baby pink accent */
}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: linear-gradient(180deg, var(--bg), #070a14);
      color: var(--text);
    }
    .wrap{ max-width: 980px; margin: 32px auto; padding: 0 16px; }
    h1{ font-size: 24px; margin: 0 0 6px; }
    p{ margin: 0 0 18px; color: var(--muted); }
    .grid{
      display:grid; grid-template-columns: 1fr; gap: 14px;
    }
    @media (min-width: 860px){
      .grid{ grid-template-columns: 1.2fr 0.8fr; gap: 16px; align-items:start; }
    }
    .card{
      background: rgba(18,26,51,0.85);
      border: 1px solid rgba(243,182,200,0.25);
      border-radius: 14px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
      padding: 16px;
    }
    .section-title{
      font-size: 14px; letter-spacing: .08em; text-transform: uppercase;
      color: var(--muted); margin: 0 0 10px;
    }
    .vars{
      display:grid; grid-template-columns: 1fr; gap: 10px;
    }
    @media (min-width: 560px){
      .vars{ grid-template-columns: 1fr 1fr; gap: 10px 14px; }
    }
    label.var{
      display:flex; gap: 10px; align-items:flex-start;
      padding: 10px; border: 1px solid rgba(34,48,95,0.7);
      border-radius: 12px; background: rgba(10,14,30,0.35);
    }
label.var:hover{
  border-color: var(--pink);
  box-shadow: 0 0 0 2px rgba(243,182,200,0.25);
}
    input[type="checkbox"]{ transform: translateY(2px) scale(1.1); accent-color: var(--accent); }
    .var .name{ font-weight: 650; }
    .var .coef{ font-size: 12px; color: var(--muted); margin-top: 2px; }
    .row{ display:flex; gap: 10px; align-items:center; flex-wrap:wrap; margin: 10px 0 0; }
    .field{
      display:flex; flex-direction:column; gap: 6px; width: 220px;
    }
    .field input{
      padding: 10px 12px; border-radius: 10px;
      border: 1px solid rgba(34,48,95,0.9);
      background: rgba(10,14,30,0.45);
      color: var(--text);
      outline: none;
    }
    .field input:focus{ border-color: rgba(122,162,255,0.9); box-shadow: 0 0 0 3px rgba(122,162,255,0.18); }
    button{
      padding: 10px 14px; border-radius: 12px;
      border: 1px solid rgba(122,162,255,0.8);
      background: rgba(122,162,255,0.18);
      color: var(--text);
      cursor:pointer; font-weight: 650;
    }
    button:hover{ background: rgba(122,162,255,0.28); }
    button.secondary{
      border-color: rgba(170,179,209,0.6);
      background: rgba(170,179,209,0.10);
      font-weight: 600;
    }
    .result{
      display:grid; gap: 12px;
    }
    .result .big{
      font-size: 38px; font-weight: 800; letter-spacing: -0.02em;
      margin: 6px 0 0;
    }
    .pill{
      display:inline-flex; align-items:center; gap: 8px;
      padding: 8px 10px; border-radius: 999px;
      border: 1px solid rgba(34,48,95,0.9);
      background: rgba(10,14,30,0.35);
      color: var(--muted);
      width: fit-content;
    }
    .note{ font-size: 12px; color: var(--muted); line-height: 1.35; }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .divider{ height:1px; background: rgba(34,48,95,0.8); margin: 12px 0; }
    .km-thumb {
  width: 100%;
  max-width: 420px;
  border-radius: 12px;
  border: 1px solid rgba(34,48,95,0.9);
  cursor: zoom-in;
}
/* Modal overlay */
.km-modal {
  display: none;
  position: fixed;
  z-index: 9999;
  inset: 0;
  background: rgba(0,0,0,0.85);
  align-items: center;
  justify-content: center;
}

/* Enlarged image */
.km-modal img {
  max-width: 90%;
  max-height: 90%;
  border-radius: 14px;
  box-shadow: 0 0 40px rgba(0,0,0,0.6);
  cursor: zoom-out;
}
    .tabs{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin: 10px 0 16px;
}
.tab{
  padding: 8px 12px;
  border-radius: 999px;
  border: 1px solid rgba(34,48,95,0.9);
  background: rgba(10,14,30,0.35);
  color: var(--muted);
  cursor:pointer;
  font-weight: 650;
}
.tab:hover{
  border-color: var(--pink);
  box-shadow: 0 0 0 2px rgba(243,182,200,0.18);
}
.tab.active{
  color: var(--text);
  border-color: rgba(122,162,255,0.85);
  background: rgba(122,162,255,0.18);
}
  </style>
</head>
<div id="kmModal" class="km-modal" onclick="closeKM()">
  <img id="kmModalImg" src="km_1y.png" alt="Kaplan‚ÄìMeier curve enlarged" />
</div>
<div id="kmModal" class="km-modal" onclick="closeKM()">
  <img
    id="kmModalImg"
    src="km_1y.png"
    alt="Kaplan‚ÄìMeier curve enlarged"
  />
</div>
<body>
  <div class="wrap">
   <h1>Children‚Äôs Heart Allograft Risk and Transplantation Index ü´Ä (C-HART)</h1>
    <p>Mortality risk calculator for pediatric heart transplant using donor, recipient, and center factors</p>
    <p>Check the boxes that apply, enter <span class="mono">meld_xi</span>, then click <b>Calculate</b>.</p>
<div class="tabs" role="tablist" aria-label="Time horizon tabs">
  <button class="tab active" id="tab-1y" type="button" onclick="setModel('1y')">1-year (Default)</button>
  <button class="tab" id="tab-90d" type="button" onclick="setModel('90d')">90-day</button>
  <button class="tab" id="tab-3y" type="button" onclick="setModel('3y')">3-year</button>
</div>

    <div class="grid">
      <!-- Inputs -->
      <div class="card">
        <div class="section-title">Binary variables (0/1)</div>
        <div class="vars" id="vars"></div>

        <div class="divider"></div>

        <div class="row">
          <div class="field">
            <label for="meld_xi" class="name"><span class="mono">meld_xi</span> (numeric)</label>
            <input id="meld_xi" type="number" step="0.01" placeholder="e.g., 12.34" />
          </div>

          <div class="field" style="width:auto; margin-top: 22px;">
            <button id="calcBtn" type="button">Calculate</button>
            <button id="resetBtn" type="button" class="secondary">Reset</button>
          </div>
        </div>

        <p class="note" style="margin-top:12px;">
          Assumes checked = 1, unchecked = 0. Coefficients match your Stata code.
        </p>
      </div>

      <!-- Output -->
      <div class="card">
        <div class="section-title">Estimated mortality risk</div>
        <div class="result">
        <div class="pill" id="riskTitle">1-year mortality risk</div>
          <div class="big" id="scoreOut">‚Äî</div>
          <div class="pill">Category</div>
          <div style="font-size:18px; font-weight:700;" id="catOut">‚Äî</div>
          <div style="margin-top:12px;">
          <div class="pill">Relative risk</div>  
             <div style="margin-top:12px;">
<div id="rrOut" style="font-size:16px; font-weight:600;">‚Äî</div>
  <div style="margin-top:12px;">
  <img
    id="kmThumb"
    src="km_1y.png"
    alt="Kaplan‚ÄìMeier curve for mortality"
    class="km-thumb"
    onclick="openKM()"
  />
</div>

          <div class="divider"></div>

          <div class="pill">Formula</div>
          <div class="note mono" style="white-space: pre-wrap;" id="formulaOut"></div>

          <div class="divider"></div>

          <div class="note">
            Categories:
            <span class="mono">Low ‚â§13</span>,
            <span class="mono">Moderate 13‚Äì18</span>,
            <span class="mono">High 18‚Äì31</span>,
            <span class="mono">Very high &gt;31</span>.
          </div>
        </div>
      </div>
    </div>
  </div>

 <script>
/* ============================
   C-HART risk calculators
   Tabs: 90-day, 1-year, 3-year
   ============================ */
document.addEventListener("DOMContentLoaded", () => {
// ---- MODELS (use your 1y descriptors exactly as provided) ----
const MODELS = {
  "1y": {
    title: "1-year mortality risk",
    kmSrc: "km_1y.png",
     relativeRisk: {
    "Low": "Reference = 1",
    "Moderate": "RR 2.9",
    "High ‚ö†Ô∏è": "RR 5.0",
    "Very High üö©": "RR 13.3"
    },
    model: [
      { key: "CENTER_VOL_5",        label: "Center volume 2‚Äì4 transplants/year", coef:  3.201134439, type: "binary" },
      { key: "CENTER_VOL_12",       label: "Center volume ‚â•12 transplants/year", coef: -2.270437723, type: "binary" },
      { key: "age1",                label: "Recipient age <2 years", coef:  3.735670653, type: "binary" },
      { key: "age11_13",            label: "Recipient age 11‚Äì13 years", coef: -6.347318681, type: "binary" },
      { key: "age5_6",              label: "Recipient age 5‚Äì6 years", coef:  5.649489698, type: "binary" },
      { key: "dage22plus",          label: "Donor age ‚â•22 years", coef:  4.376786359, type: "binary" },
      { key: "cod_999",             label: "Donor cause of death code = 999 (other/unknown)", coef:  5.253360367, type: "binary" },
      { key: "HGT_RATIO_HIGH",      label: "Donor/recipient height ratio >1.3", coef:  3.558994433, type: "binary" },
      { key: "DIAG_nosurg_CHD",     label: "Recipient has Congenital heart disease w/o past history of surgery (non-surgical)", coef:  6.441370672, type: "binary" },
      { key: "DIAG_surg_CHD",       label: "Recipient has Congenital heart disease w/ past history of surgery (surgical)", coef: 12.0072624, type: "binary" },
      { key: "medicaid",            label: "Recipient on Medicaid insurance", coef:  4.43259163, type: "binary" },
      { key: "IV_THERAPY_INF",      label: "Recipient has infection requiring IV therapy in past 2 weeks", coef:  2.97083738, type: "binary" },
      { key: "hawai_pac_ind_alask", label: "Recipient is Native Hawaiian/Pacific Islander or American Indian/Alaska Native", coef:  8.335493527, type: "binary" },
      { key: "vad_3_4",             label: "Recipient has BiVAD or TAH (Total artificial Heart)  ‚öëFLAG: verify mapping", coef:  6.824203533, type: "binary" },
      { key: "y_ventilator",        label: "Recipient on mechanical ventilation at transplant", coef:  3.564940276, type: "binary" },
      { key: "y_ecmo",              label: "Recipient on ECMO at transplant", coef:  8.121272772, type: "binary" },
      { key: "meld_xi",             label: "MELD-XI (numeric)", coef:  0.397523026, type: "numeric" },
      { key: "y_steroids",          label: "Recipient on chronic steroids use at time of transplant", coef:  3.975485211, type: "binary" },
      { key: "hispanic",            label: "Recipient is of Hispanic ethnicity", coef: -3.887255496, type: "binary" },
      { key: "lt3_albumin",         label: "Recipient Albumin ‚â§3 g/dL", coef:  2.570872888, type: "binary" },
      { key: "eGFR_TRR_LE55",       label: "Recipient eGFR ‚â§55 mL/min/1.73m¬≤", coef:  7.554048212, type: "binary" },
      { key: "INHALED_NO_TRR",      label: "Recipient on Life Support: Inhaled nitric oxide (INHALED_NO_TRR)", coef: 11.32158922, type: "binary" }
    ],
    categorize: (s) => {
      if (s <= 13) return "Low";
      if (s <= 18) return "Moderate";
      if (s <= 31) return "High ‚ö†Ô∏è";
      return "Very High üö©";
    }
  },

  "90d": {
    title: "90-day mortality risk",
    kmSrc: "km_90d.png",
    relativeRisk: {
    "Low": "Reference = 1",
    "Moderate": "RR 3.4",
    "High ‚ö†Ô∏è": "RR 7.9",
    "Very High üö©": "RR 30.6"
    },
    model: [
      { key: "CENTER_VOL_5",      label: "Center volume 2‚Äì4 transplants/year", coef:  4.611508084, type: "binary" },
      { key: "age11_13",          label: "Recipient age 11‚Äì13 years", coef: -10.8200122, type: "binary" },
      { key: "age5_6",            label: "Recipient age 5‚Äì6 years", coef:  5.06740491, type: "binary" },
      { key: "HGT_RATIO_HIGH",    label: "Donor/recipient height ratio >1.3", coef:  5.210959034, type: "binary" },
      { key: "DIAG_nosurg_CHD",   label: "Recipient has Congenital heart disease w/o past history of surgery", coef:  9.527896674, type: "binary" },
      { key: "DIAG_surg_CHD",     label: "Recipient has Congenital heart disease w/ past history of surgery", coef: 12.58257844, type: "binary" },
      { key: "IV_THERAPY_INF",    label: "Infection requiring IV therapy in past 2 weeks ", coef:  4.251298174, type: "binary" },
      { key: "vad_5",             label: "Other/unspecified VAD support at transplant", coef:  8.280158661, type: "binary" },
      { key: "y_ecmo",            label: "Recipient on ECMO at transplant", coef: 12.08404072, type: "binary" },
      { key: "meld_xi",           label: "MELD-XI (numeric)", coef:  0.8175508687, type: "numeric" },
      { key: "y_steroids",        label: "Chronic steroid use at transplant", coef:  5.18094144, type: "binary" },
      { key: "cmv_pos",           label: "Recipient is CMV+", coef:  3.18028186, type: "binary" },
      { key: "eGFR_TRR_LE55",     label: "Recipient eGFR ‚â§55 mL/min/1.73m¬≤", coef:  8.720813399, type: "binary" },
      { key: "INHALED_NO_TRR",    label: "Recipient on Life Support: Inhaled nitric oxide (INHALED_NO_TRR)", coef:  8.734116229, type: "binary" },
      { key: "N_RHCROSS",         label: "Rh crossmatch not done", coef:  6.919069117, type: "binary" }
    ],
    categorize: (s) => {
      if (s <= 16) return "Low";
      if (s <= 25) return "Moderate";
      if (s <= 44) return "High ‚ö†Ô∏è";
      return "Very High üö©";
    }
  },

  "3y": {
    title: "3-year mortality risk",
    kmSrc: "km_3y.png",
     relativeRisk: {
    "Low": "Reference = 1",
    "Moderate": "RR 2.2",
    "High ‚ö†Ô∏è": "RR 3.1",
    "Very High üö©": "RR 5.4"
    },
    model: [
      { key: "CENTER_VOL_2",        label: "Center volume <2 transplants/year", coef:  3.862068526, type: "binary" },
      { key: "age1",                label: "Recipient age <2 years", coef:  5.339527189, type: "binary" },
      { key: "age5_6",              label: "Recipient age 4-6 (over 4, including 6)", coef:  5.24349759, type: "binary" },
      { key: "age14_17",            label: "Recipient age 13‚Äì17 years (over 13, including 17)", coef:  4.731412019, type: "binary" },
      { key: "dage22plus",          label: "Donor age ‚â•22 years", coef:  4.11471699, type: "binary" },
      { key: "DON_Black",           label: "Donor race: Black", coef:  2.357699024, type: "binary" },
      { key: "TCR_Black",           label: "Recipient race: Black", coef:  3.61912305, type: "binary" },
      { key: "DONOR_MALE",          label: "Donor sex: male", coef:  2.43528754, type: "binary" },
      { key: "HGT_RATIO_HIGH",      label: "Donor/recipient height ratio >1.3", coef:  3.014784631, type: "binary" },
      { key: "DIAG_nosurg_CHD",     label: "Recipient has Congenital heart disease w/o past history of surgery", coef:  4.839250254, type: "binary" },
      { key: "DIAG_surg_CHD",       label: "Recipient has Congenital heart disease w/ past history of surgery", coef:  9.078233849, type: "binary" },
      { key: "medicaid",            label: "Recipient on Medicaid insurance", coef:  4.086187967, type: "binary" },
      { key: "IV_THERAPY_INF",      label: "Infection requiring IV therapy in past 2 weeks", coef:  3.369871041, type: "binary" },
      { key: "hawai_pac_ind_alask", label: "Recipient is Native Hawaiian/Pacific Islander or American Indian/Alaska Native", coef:  9.625760472, type: "binary" },
      { key: "vad_3_4",             label: "BiVAD or TAH (Total artificial heart)", coef:  7.266375644, type: "binary" },
      { key: "transfusion_TRR",     label: "Recipient received a transfusion between time of listing and time of transplant", coef:  2.013019507, type: "binary" },
      { key: "y_ecmo",              label: "Recipient on ECMO at transplant", coef:  5.822357314, type: "binary" },
      { key: "meld_xi",             label: "MELD-XI (numeric)", coef:  0.3292013691, type: "numeric" },
      { key: "y_steroids",          label: "Chronic steroid use at transplant", coef:  4.822662599, type: "binary" },
      { key: "b_blood",             label: "Recipient blood type B", coef: -2.876671392, type: "binary" },
      { key: "cod_anoxia",          label: "Donor cause of death: anoxia", coef:  2.159545724, type: "binary" },
      { key: "eGFR_TRR_LE55",       label: "Recipient eGFR ‚â§55 mL/min/1.73m¬≤", coef:  6.502694286, type: "binary" },
      { key: "INHALED_NO_TRR",      label: "Recipient on Life Support: Inhaled nitric oxide (INHALED_NO_TRR)", coef: 10.6654526, type: "binary" },
      { key: "N_RHCROSS",           label: "Rh crossmatch not done", coef:  4.091961391, type: "binary" }
    ],
    categorize: (s) => {
      if (s <= 15) return "Low";
      if (s <= 26) return "Moderate";
      if (s <= 32) return "High ‚ö†Ô∏è";
      return "Very High üö©";
    }
  }
};

// ---- ACTIVE MODEL ----
let ACTIVE_KEY = "1y";
let MODEL = MODELS[ACTIVE_KEY].model;

// ---- DOM refs ----
 const varsDiv     = document.getElementById("vars");
  const scoreOut    = document.getElementById("scoreOut");
  const catOut      = document.getElementById("catOut");
  const formulaOut  = document.getElementById("formulaOut");
  const meldInput   = document.getElementById("meld_xi");
  const riskTitleEl = document.getElementById("riskTitle"); // add id in HTML if you want auto title swap
  const kmThumb     = document.getElementById("kmThumb");
  const kmModalImg  = document.getElementById("kmModalImg");
  const rrOut = document.getElementById("rrOut");
function currentModel() {
    return MODELS[ACTIVE_KEY].model;
  }

  function writtenFormula() {
    const title = MODELS[ACTIVE_KEY].title;
    const terms = currentModel().map(v => {
      const sign = v.coef < 0 ? " ‚àí " : " + ";
      const mag = Math.abs(v.coef);
      return `${sign}${mag}*(${v.key})`;
    });
    return (`${title} =` + terms.join("")).replace(`${title} = + `, `${title} = `);
  }

  function buildUI() {
    if (!varsDiv) return;
    varsDiv.innerHTML = "";

    currentModel().filter(v => v.type === "binary").forEach(v => {
      const id = `chk_${v.key}`;
      const row = document.createElement("label");
      row.className = "var";
      row.htmlFor = id;
      row.innerHTML = `
        <input id="${id}" type="checkbox" />
        <div>
          <div class="name">${v.label}</div>
          <div class="coef mono">${v.key} ‚Ä¢ coef: ${v.coef}</div>
        </div>
      `;
      varsDiv.appendChild(row);
    });

    if (formulaOut) formulaOut.textContent = writtenFormula();
  }

  function getBinaryValue(key) {
    const el = document.getElementById(`chk_${key}`);
    return el && el.checked ? 1 : 0;
  }

  function calculate() {
    const meld = Number(meldInput?.value);
    if (!Number.isFinite(meld)) {
      alert("Please enter a valid numeric meld_xi value.");
      return;
    }

    let score = 0;
    for (const v of currentModel()) {
      if (v.type === "binary") score += v.coef * getBinaryValue(v.key);
      else score += v.coef * meld;
    }

    const category = MODELS[ACTIVE_KEY].categorize(score);

    if (scoreOut) scoreOut.textContent = score.toFixed(3);
    if (catOut) catOut.textContent = category;

    const rrMap = MODELS[ACTIVE_KEY].relativeRisk;
    if (rrOut) rrOut.textContent = (rrMap && rrMap[category]) ? rrMap[category] : "‚Äî";
  }

  function resetAll() {
    currentModel().filter(v => v.type === "binary").forEach(v => {
      const el = document.getElementById(`chk_${v.key}`);
      if (el) el.checked = false;
    });
    if (meldInput) meldInput.value = "";
    if (scoreOut) scoreOut.textContent = "‚Äî";
    if (catOut) catOut.textContent = "‚Äî";
    if (rrOut) rrOut.textContent = "‚Äî";
  }

  // Global for onclick usage
  window.setModel = function(key) {
    ACTIVE_KEY = key;

    document.querySelectorAll(".tab").forEach(btn => btn.classList.remove("active"));
    const tabId = key === "1y" ? "tab-1y" : key === "90d" ? "tab-90d" : "tab-3y";
    const tabEl = document.getElementById(tabId);
    if (tabEl) tabEl.classList.add("active");

    const newTitle = MODELS[ACTIVE_KEY].title;
    if (riskTitleEl) riskTitleEl.textContent = newTitle;

    const src = MODELS[ACTIVE_KEY].kmSrc;
    if (kmThumb && src) kmThumb.src = src;
    if (kmModalImg && src) kmModalImg.src = src;

    if (scoreOut) scoreOut.textContent = "‚Äî";
    if (catOut) catOut.textContent = "‚Äî";
    if (rrOut) rrOut.textContent = "‚Äî";

    buildUI();
  };

  window.openKM = function() {
    const modal = document.getElementById("kmModal");
    if (modal && kmModalImg && kmThumb) kmModalImg.src = kmThumb.src;
    if (modal) modal.style.display = "flex";
  };

  window.closeKM = function() {
    const modal = document.getElementById("kmModal");
    if (modal) modal.style.display = "none";
  };

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") window.closeKM();
  });

  const calcBtn = document.getElementById("calcBtn");
  const resetBtn = document.getElementById("resetBtn");
  if (calcBtn) calcBtn.addEventListener("click", calculate);
  if (resetBtn) resetBtn.addEventListener("click", resetAll);

  buildUI();
});
</script>
</body>
</html>
